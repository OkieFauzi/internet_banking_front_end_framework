<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="shortcut icon" href="img/icons/icon-48x48.png" />

	<title>Transfer Confirmation | Makers Internet Banking</title>

	<link href="css/app.css" rel="stylesheet">

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
	<div class="wrapper">

		<!--SIDEBAR-->
		<nav id="sidebar" class="sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="index.html">
          <span class="align-middle">Makers Internet Banking</span>
        </a>

				<ul class="sidebar-nav">
					<li class="sidebar-header">
						Pages
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="index.html">
              <i class="align-middle" data-feather="book"></i> <span class="align-middle">Home</span>
            </a>
					</li>

					<li class="sidebar-item active">
						<a class="sidebar-link" href="pages-blank.html">
              <i class="align-middle" data-feather="credit-card"></i> <span class="align-middle">Transfer</span>
            </a>
					</li>

				</ul>
			</div>
		</nav>

		
		<div class="main">
			<!--NAVBAR-->
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle d-flex">
          <i class="hamburger align-self-center"></i>
        </a>
		<!--user profile-->
				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						<!--avatar profile-->
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-toggle="dropdown">
                <i class="align-middle" data-feather="settings"></i>
              </a>
							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-toggle="dropdown">
                <img src="img/avatars/avatar-7.png" class="avatar img-fluid rounded mr-1" alt="Charles Hall" /> <span class="text-dark" id="user_name"></span>
              </a>
							<div class="dropdown-menu dropdown-menu-right">
								<a class="dropdown-item" href="pages-profile.html"><i class="align-middle mr-1" data-feather="user"></i> Profile</a>
								<a class="dropdown-item" href="#"><i class="align-middle mr-1" data-feather="pie-chart"></i> Analytics</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="pages-settings.html"><i class="align-middle mr-1" data-feather="settings"></i> Settings & Privacy</a>
								<a class="dropdown-item" href="#"><i class="align-middle mr-1" data-feather="help-circle"></i> Help Center</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#" id="logout" data-toggle="modal" data-target="#defaultModalPrimary">Log out</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>

			<!--quit Modal-->
			<div class="modal fade" id="defaultModalPrimary" tabindex="-1" role="dialog" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title"><strong>Confirmation</strong></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
						</div>
						<div class="modal-body m-3">
							<h4 class="mb-0">Are you sure want to quit?</h4>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
							<button type="button" class="btn btn-primary" id="sure-quit">Yes</button>
						</div>
					</div>
				</div>
			</div>
			<!-- END primary modal -->

			<!--Alert Modal-->
			<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title"><strong>Alert</strong></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
						</div>
						<div class="modal-body m-3">
							<h4 id="alert-content" class="mb-0"></h4>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
			<!-- END alert modal -->

			<!--MAIN CONTENT-->
			<main class="content">
				<div class="container-fluid p-0">
					<!--header-->
					<div class="row mb-2 mb-xl-3">
						<div class="col-auto d-none d-sm-block">
							<h3><strong>Transfer</strong> Confirmation</h3>
						</div>
						<!--breadcrumbs-->
						<div class="col-auto ml-auto text-right mt-n1">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb bg-transparent p-0 mt-1 mb-0">
									<li class="breadcrumb-item"><a href="transfer-index.html">Transfer Form</a></li>
									<li class="breadcrumb-item active" aria-current="page">Confirmation</li>
								</ol>
							</nav>
						</div>
					</div>

					<!--Table Card-->
					<div class="row">
						<div class="col-9">
							<div class="card">
								<div class="card-header">
									<h5 class="card-title">Confirmation</h5>
									<h6 class="card-subtitle text-muted">Confirm to continue your transfer process.</h6>
								</div>
								<div class="card-body">
									<form id="validation">
										<div class="mb-3 row">
											<p class="col-sm-3 text-sm-right">Sender Name</p>
											<div class="col-sm-9">
												<p id="sender-name"></p>
											</div>
										</div>
										<div class="mb-3 row">
											<p class="col-sm-3 text-sm-right">Sender Account</p>
											<div class="col-sm-9">
												<p id="sender-account"></p>
											</div>
										</div>
										<div class="mb-3 row">
											<p class="col-sm-3 text-sm-right">Receiver Name</p>
											<div class="col-sm-9">
												<p id="receiver-name"></p>
											</div>
										</div>
										<div class="mb-3 row">
											<p class="col-sm-3 text-sm-right">Receiver Account</p>
											<div class="col-sm-9">
												<p id="receiver-account"></p>
											</div>
										</div>
										<div class="mb-3 row">
											<p class="col-sm-3 text-sm-right">Amount</p>
											<div class="col-sm-9">
												<p id="amount"></p>
											</div>
										</div>
										<div class="mb-3 row">
											<label class="col-form-label col-sm-3 text-sm-right">Password</label>
											<div class="col-sm-9">
												<input name="password" type="password" class="form-control" placeholder="Insert password">
											</div>
										</div>
										<div class="mb-3 row">
											<div class="col-sm-9 ml-sm-auto">
												<button type="submit" class="btn btn-primary">Continue</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>

			<!--FOOTER-->
			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-left">
							<p class="mb-0">
								<a href="index.html" class="text-muted"><strong>Makers Internet Banking</strong></a> &copy;
							</p>
						</div>
						<div class="col-6 text-right">
							<ul class="list-inline">
								<li class="list-inline-item">
									<a class="text-muted" href="#">Support</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#">Help Center</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#">Privacy</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#">Terms</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<script src="js/app.js"></script>
	<script src="js/navbar.js"></script>
	<script>
		//get const selected from query string
		const urlParams= new URLSearchParams(window.location.search);
        const account_source = urlParams.get('source');
        const account_destination = urlParams.get('destination');
        const amount = urlParams.get('amount');
		//input data function
        async function getNames(id, position) {           
            //fetch data
            const response = await fetch('http://127.0.0.1:5000/account_id/' + id);
			const data = await response.json();
			//input name
			const firstName = data['first_name'].charAt(0).toUpperCase() + data['first_name'].slice(1);
			const lastName = data['last_name'].charAt(0).toUpperCase() + data['last_name'].slice(1);
			const name = document.getElementById(position + '-name');
			name.textContent = ": " + firstName + " " + lastName;
			//input account
			const account_number = document.getElementById(position + '-account');
			account_number.textContent = ': ' + id;
        }
        //call user caller function
        getNames(account_source, 'sender');
        getNames(account_destination, 'receiver');
        //add amount status
        const amount_table = document.getElementById('amount');
        amount_table.textContent = ': ' + formatter.format(amount);
        //password confirmation
        const form = document.getElementById('validation');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
			e.stopPropagation();
			//modal declaration
			const modalContent = document.getElementById('alert-content');
			//check password
			const password = form.elements['password'].value;
			if (password === "") {
				modalContent.textContent = "Please fill the password."
				$('#alert-modal').modal('show');
			} else {
				fetch('http://127.0.0.1:5000/account_id/' + account_source)
				.then(response => response.json())
				.then(data => {
					if (data['password'] !== password) {
						modalContent.textContent = "Incorrect password."
						$('#alert-modal').modal('show');
					} else {
						window.location.href = `transfer-receipt.html?source=${account_source}&destination=${account_destination}&amount=${amount}`
					}
				})
			}
        })
	</script>

</body>

</html>